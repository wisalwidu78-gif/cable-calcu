<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Cable Calculator">
  <meta name="theme-color" content="#4F46E5">
  <title>Cable Calculator</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkNhYmxlIENhbGN1bGF0b3IiLAogICJzaG9ydF9uYW1lIjogIkNhYmxlQ2FsYyIsCiAgImRlc2NyaXB0aW9uIjogIlBpeGVsIFN0cmluZyBDYWJsZSBDYWxjdWxhdG9yIGZvciBQWEw0MCBhbmQgUFhMNjAiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiM0RjQ2RTUiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXHPRE5uSWlCb1pXbG5hSFE5SWpVeE1pSTJDaUFnUEhKbFkzUWdkMmxrZEdnOUlqVXhNaUlnYUdWcFoyaDBQU0kxTVRJaUlHWnBiR3c5SWlNMFJqUTJSVFVpTHo0S0lDQThkR1Y0ZENCNFBTSTFNQ1VpSUhrOUlqVXdKU0lnWm1sc2JEMGlJMlptWmlJZ1ptOXVkQzF6YVhwbFBTSTJNQ0lnWm05dWRDMW1ZVzFwYkhsOUltMXZibTl6Y0dGalpTSWdabTl1ZEMxM1pXbG5hSFE5SW1KdmJHUWlJSFJsZUhRdFlXNWphRzl5UFNKdGFXUmtiR1VpUGp3dlkzUjBQand2ZEdWNGRENEtQQzl6ZG1jKyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIj4KICA8cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9iNTEyIiBmaWxsPSIjNEY0NkU1Ii8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZpbGw9IiNmZmYiIGZvbnQtc2l6ZT0iNjAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtd2VpZ2h0PSJib2xkIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIj5DQzwvdGV4dD4KPC9zdmc+">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overscroll-behavior: none;
    }
    
    #root {
      width: 100%;
      min-height: 100vh;
    }
    
    /* Prevent zoom on input focus for iOS */
    input[type="number"] {
      font-size: 16px !important;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // Lucide React icons as inline SVG components
    const ChevronRight = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    );

    const Plus = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Trash2 = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const Calculator = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
        <line x1="8" y1="6" x2="16" y2="6"></line>
        <line x1="8" y1="10" x2="8" y2="10.01"></line>
        <line x1="12" y1="10" x2="12" y2="10.01"></line>
        <line x1="16" y1="10" x2="16" y2="10.01"></line>
        <line x1="8" y1="14" x2="8" y2="14.01"></line>
        <line x1="12" y1="14" x2="12" y2="14.01"></line>
        <line x1="16" y1="14" x2="16" y2="14.01"></line>
        <line x1="8" y1="18" x2="8" y2="18.01"></line>
        <line x1="12" y1="18" x2="12" y2="18.01"></line>
        <line x1="16" y1="18" x2="16" y2="18.01"></line>
      </svg>
    );

    function CableCalculatorApp() {
      const [screen, setScreen] = useState('home');
      const [pixelType, setPixelType] = useState('');

      const goToCalculator = (type) => {
        setPixelType(type);
        setScreen(type);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
          {screen === 'home' && <HomeScreen onSelect={goToCalculator} />}
          {screen === 'pxl40' && <CalculatorScreen pixelType="PXL40" onBack={() => setScreen('home')} />}
          {screen === 'pxl60' && <CalculatorScreen pixelType="PXL60" onBack={() => setScreen('home')} />}
        </div>
      );
    }

    function HomeScreen({ onSelect }) {
      return (
        <div className="flex flex-col items-center justify-center min-h-screen p-6">
          <div className="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md">
            <div className="text-center mb-8">
              <div className="bg-indigo-600 w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center">
                <Calculator />
              </div>
              <h1 className="text-3xl font-bold text-gray-800 mb-2">Cable Calculator</h1>
              <p className="text-gray-600">Select your pixel string type</p>
            </div>

            <div className="space-y-4">
              <button
                onClick={() => onSelect('pxl40')}
                className="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-2xl p-6 flex items-center justify-between transition-all transform active:scale-95 shadow-lg"
              >
                <div className="text-left">
                  <div className="text-2xl font-bold">Pixel 40</div>
                  <div className="text-sm opacity-90">Plastic connectors</div>
                </div>
                <ChevronRight />
              </button>

              <button
                onClick={() => onSelect('pxl60')}
                className="w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-2xl p-6 flex items-center justify-between transition-all transform active:scale-95 shadow-lg"
              >
                <div className="text-left">
                  <div className="text-2xl font-bold">Pixel 60</div>
                  <div className="text-sm opacity-90">Standard connectors</div>
                </div>
                <ChevronRight />
              </button>
            </div>
          </div>
        </div>
      );
    }

    function CalculatorScreen({ pixelType, onBack }) {
      const [strings, setStrings] = useState([
        {
          id: 1,
          pitchLength: '',
          leadInLength: '',
          leadOutLength: '',
          numStrings: '',
          ledsPerString: ''
        }
      ]);

      const addStringType = () => {
        setStrings([
          ...strings,
          {
            id: Date.now(),
            pitchLength: '',
            leadInLength: '',
            leadOutLength: '',
            numStrings: '',
            ledsPerString: ''
          }
        ]);
      };

      const removeStringType = (id) => {
        if (strings.length > 1) {
          setStrings(strings.filter(s => s.id !== id));
        }
      };

      const updateString = (id, field, value) => {
        setStrings(strings.map(s => 
          s.id === id ? { ...s, [field]: value } : s
        ));
      };

      const calculateCableLength = (woLength, cableType) => {
        const length = parseFloat(woLength) || 0;
        
        if (pixelType === 'PXL40') {
          // PXL40 Plastic
          if (cableType === 'pitch') {
            // Pitch: Subtract 15mm
            return Math.max(0, length - 15);
          } else {
            // Lead In/Out: Add 54.5mm (Y + Z - 7.5 = 22 + 40 - 7.5)
            return length + 54.5;
          }
        } else {
          // PXL60
          if (cableType === 'pitch') {
            // Pitch: Subtract 20mm
            return Math.max(0, length - 20);
          } else {
            // Lead In/Out: Add 55mm (Y + Z - 5 = 20 + 40 - 5)
            return length + 55;
          }
        }
      };

      const calculateQuantities = (string) => {
        const numStrings = parseInt(string.numStrings) || 0;
        const ledsPerString = parseInt(string.ledsPerString) || 0;
        const pitchCablesPerString = Math.max(0, ledsPerString - 1);
        
        return {
          leadIn: numStrings,
          leadOut: numStrings,
          pitch: numStrings * pitchCablesPerString
        };
      };

      const getTotalQuantities = () => {
        return strings.reduce((totals, string) => {
          const qty = calculateQuantities(string);
          return {
            leadIn: totals.leadIn + qty.leadIn,
            leadOut: totals.leadOut + qty.leadOut,
            pitch: totals.pitch + qty.pitch
          };
        }, { leadIn: 0, leadOut: 0, pitch: 0 });
      };

      const bgColor = pixelType === 'PXL40' ? 'from-blue-500 to-blue-600' : 'from-purple-500 to-purple-600';
      const totals = getTotalQuantities();

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 pb-8">
          {/* Header */}
          <div className={`bg-gradient-to-r ${bgColor} text-white p-6 shadow-lg sticky top-0 z-10`}>
            <button onClick={onBack} className="mb-3 text-white hover:text-gray-200 flex items-center active:opacity-70">
              <span className="text-2xl mr-2">‚Üê</span> Back
            </button>
            <h1 className="text-3xl font-bold">{pixelType} Calculator</h1>
            <p className="text-sm opacity-90 mt-1">
              {pixelType === 'PXL40' ? 'Pitch: -15mm | Lead In/Out: +54.5mm' : 'Pitch: -20mm | Lead In/Out: +55mm'}
            </p>
          </div>

          <div className="p-4 space-y-4 max-w-6xl mx-auto">
            {/* String Configurations */}
            {strings.map((string, index) => (
              <div key={string.id} className="bg-white rounded-2xl shadow-lg p-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-bold text-gray-800">
                    String Type {index + 1}
                  </h2>
                  {strings.length > 1 && (
                    <button
                      onClick={() => removeStringType(string.id)}
                      className="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors active:opacity-70"
                    >
                      <Trash2 />
                    </button>
                  )}
                </div>

                {/* Work Order Inputs */}
                <div className="bg-blue-50 rounded-xl p-4 mb-4">
                  <h3 className="font-semibold text-blue-900 mb-3">Work Order Lengths (mm)</h3>
                  <div className="grid grid-cols-1 gap-3">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Pitch Cable Length
                      </label>
                      <input
                        type="number"
                        inputMode="decimal"
                        value={string.pitchLength}
                        onChange={(e) => updateString(string.id, 'pitchLength', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="e.g., 150"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Lead-In Cable Length
                      </label>
                      <input
                        type="number"
                        inputMode="decimal"
                        value={string.leadInLength}
                        onChange={(e) => updateString(string.id, 'leadInLength', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="e.g., 160"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Lead-Out Cable Length
                      </label>
                      <input
                        type="number"
                        inputMode="decimal"
                        value={string.leadOutLength}
                        onChange={(e) => updateString(string.id, 'leadOutLength', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="e.g., 160"
                      />
                    </div>
                  </div>
                </div>

                {/* String Configuration */}
                <div className="bg-green-50 rounded-xl p-4 mb-4">
                  <h3 className="font-semibold text-green-900 mb-3">String Configuration</h3>
                  <div className="grid grid-cols-1 gap-3">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Number of Strings
                      </label>
                      <input
                        type="number"
                        inputMode="numeric"
                        value={string.numStrings}
                        onChange={(e) => updateString(string.id, 'numStrings', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        placeholder="e.g., 100"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        LEDs per String
                      </label>
                      <input
                        type="number"
                        inputMode="numeric"
                        value={string.ledsPerString}
                        onChange={(e) => updateString(string.id, 'ledsPerString', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        placeholder="e.g., 10"
                      />
                    </div>
                  </div>
                </div>

                {/* Calculated Results */}
                <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-4">
                  <h3 className="font-semibold text-indigo-900 mb-3">‚úÇÔ∏è Cut Lengths & Quantities</h3>
                  <div className="grid grid-cols-1 gap-3">
                    <ResultBox
                      label="Pitch Cable"
                      length={calculateCableLength(string.pitchLength, 'pitch')}
                      quantity={calculateQuantities(string).pitch}
                    />
                    <ResultBox
                      label="Lead-In Cable"
                      length={calculateCableLength(string.leadInLength, 'leadIn')}
                      quantity={calculateQuantities(string).leadIn}
                    />
                    <ResultBox
                      label="Lead-Out Cable"
                      length={calculateCableLength(string.leadOutLength, 'leadOut')}
                      quantity={calculateQuantities(string).leadOut}
                    />
                  </div>
                </div>
              </div>
            ))}

            {/* Add Another String Type Button */}
            <button
              onClick={addStringType}
              className="w-full bg-white hover:bg-gray-50 active:bg-gray-100 text-gray-700 font-semibold py-4 px-6 rounded-2xl shadow-lg border-2 border-dashed border-gray-300 hover:border-gray-400 flex items-center justify-center transition-all"
            >
              <Plus />
              <span className="ml-2">Add Another String Type</span>
            </button>

            {/* Total Summary */}
            {strings.length > 1 && (
              <div className="bg-gradient-to-r from-yellow-400 to-orange-400 text-white rounded-2xl shadow-2xl p-6">
                <h2 className="text-2xl font-bold mb-4">üìä Total Cable Quantities</h2>
                <div className="grid grid-cols-1 gap-4">
                  <div className="bg-white bg-opacity-20 rounded-xl p-4 text-center backdrop-blur-sm">
                    <div className="text-3xl font-bold">{totals.pitch}</div>
                    <div className="text-sm font-medium mt-1">Pitch Cables</div>
                  </div>
                  <div className="bg-white bg-opacity-20 rounded-xl p-4 text-center backdrop-blur-sm">
                    <div className="text-3xl font-bold">{totals.leadIn}</div>
                    <div className="text-sm font-medium mt-1">Lead-In Cables</div>
                  </div>
                  <div className="bg-white bg-opacity-20 rounded-xl p-4 text-center backdrop-blur-sm">
                    <div className="text-3xl font-bold">{totals.leadOut}</div>
                    <div className="text-sm font-medium mt-1">Lead-Out Cables</div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    function ResultBox({ label, length, quantity }) {
      return (
        <div className="bg-white rounded-lg p-4 border-2 border-indigo-200">
          <div className="text-sm font-medium text-gray-600 mb-2">{label}</div>
          <div className="space-y-1">
            <div className="flex justify-between items-center">
              <span className="text-xs text-gray-500">Cut length:</span>
              <span className="text-2xl font-bold text-indigo-600">{length.toFixed(1)} mm</span>
            </div>
            <div className="flex justify-between items-center pt-2 border-t border-gray-200">
              <span className="text-xs text-gray-500">Quantity:</span>
              <span className="text-xl font-bold text-green-600">{quantity}</span>
            </div>
          </div>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CableCalculatorApp />);
  </script>

  <!-- Service Worker for PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4gewogIGV2ZW50LndhaXRVbnRpbChzZWxmLnNraXBXYWl0aW5nKCkpOwp9KTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBldmVudCA9PiB7CiAgZXZlbnQud2FpdFVudGlsKHNlbGYuY2xpZW50cy5jbGFpbSgpKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZXZlbnQgPT4gewogIGV2ZW50LnJlc3BvbmRXaXRoKGZldGNoKGV2ZW50LnJlcXVlc3QpKTsKfSk7')
          .then(() => console.log('Service Worker registered'))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }
  </script>
</body>
</html>
